{"ast":null,"code":"var _jsxFileName = \"/home/mint/Projects/members-only/client/src/pages/Messages/index.js\",\n    _s = $RefreshSig$();\n\nimport SignUpModal from '../../components/SignUpModal/index.js';\nimport LogInModal from '../../components/LogInModal/index.js';\nimport MembershipModal from '../../components/MembershipModal/index.js';\nimport NewMessageModal from '../../components/NewMessageModal/index.js';\nimport { useContext, useState, useEffect, useCallback } from 'react';\nimport { ModalContext } from '../../context/ModalContext.js';\nimport { UserContext } from '../../context/UserContext.js';\nimport axios from '../../lib/axios.js';\nimport Spinner from './../../components/elements/Spinner.js';\nimport Message from './Message.js';\nimport Pagination from './Pagination.js';\nimport Header from './Header.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Messages() {\n  _s();\n\n  const {\n    signupModal,\n    setSignupModal,\n    loginModal,\n    setLoginModal,\n    membershipModal,\n    setMembershipModal,\n    newMessageModal,\n    setNewMessageModal\n  } = useContext(ModalContext);\n  const {\n    auth\n  } = useContext(UserContext);\n  const [loading, setLoading] = useState(false);\n  const [page, setPage] = useState(1);\n  const [messages, setMessages] = useState([]);\n  const [totalPages, setTotalPages] = useState(1);\n  const [deleteMsgId, setDeleteMsgId] = useState('');\n\n  const handlePageClick = e => {\n    setPage(e.selected + 1);\n  };\n\n  const getMessages = useCallback(async page => {\n    setLoading(true);\n\n    try {\n      const {\n        data\n      } = await axios.get('/api/messages', {\n        params: {\n          page,\n          limit: 10\n        }\n      });\n      setMessages(data === null || data === void 0 ? void 0 : data.messages);\n      setTotalPages(data === null || data === void 0 ? void 0 : data.totalPages);\n    } catch (error) {\n      console.error(error);\n    }\n  }, []);\n\n  const handleDeleteMessage = async id => {\n    if (!id || !auth.is_admin) return;\n    const token = localStorage.getItem('token');\n    setDeleteMsgId(id);\n\n    try {\n      await axios.delete(`/api/messages/${id}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      getMessages(page).finally(() => {\n        setLoading(false);\n        setDeleteMsgId('');\n      });\n    } catch (error) {\n      setDeleteMsgId('');\n      console.error(error);\n    }\n  };\n\n  useEffect(() => {\n    getMessages(page).finally(() => setLoading(false));\n  }, [page, getMessages]);\n  const messagesComponents = messages.map(message => /*#__PURE__*/_jsxDEV(Message, {\n    message: message,\n    auth: auth,\n    handleDeleteMessage: handleDeleteMessage,\n    deleteMsgId: deleteMsgId\n  }, message._id, false, {\n    fileName: _jsxFileName,\n    lineNumber: 87,\n    columnNumber: 5\n  }, this));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative min-h-screen pb-[90px] sm:pb-[110px]\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex justify-center items-center absolute inset-0 m-auto\",\n      children: /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"bg-white w-full\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"max-w-7xl space-y-8 mt-12 mx-auto px-4 sm:px-6 lg:px-8\",\n        children: messagesComponents\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Pagination, {\n      totalPages: totalPages,\n      page: page,\n      handlePageClick: handlePageClick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(SignUpModal, {\n      open: signupModal,\n      close: setSignupModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(LogInModal, {\n      open: loginModal,\n      close: setLoginModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(MembershipModal, {\n      open: membershipModal,\n      close: setMembershipModal\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(NewMessageModal, {\n      open: newMessageModal,\n      close: setNewMessageModal,\n      getMessages: getMessages,\n      stopMessagesSpinner: () => setLoading(false),\n      page: page,\n      setPage: setPage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Messages, \"uNmNNjJovb76kzeYaayFwPP7mHw=\");\n\n_c = Messages;\n\nvar _c;\n\n$RefreshReg$(_c, \"Messages\");","map":{"version":3,"names":["SignUpModal","LogInModal","MembershipModal","NewMessageModal","useContext","useState","useEffect","useCallback","ModalContext","UserContext","axios","Spinner","Message","Pagination","Header","Messages","signupModal","setSignupModal","loginModal","setLoginModal","membershipModal","setMembershipModal","newMessageModal","setNewMessageModal","auth","loading","setLoading","page","setPage","messages","setMessages","totalPages","setTotalPages","deleteMsgId","setDeleteMsgId","handlePageClick","e","selected","getMessages","data","get","params","limit","error","console","handleDeleteMessage","id","is_admin","token","localStorage","getItem","delete","headers","Authorization","finally","messagesComponents","map","message","_id"],"sources":["/home/mint/Projects/members-only/client/src/pages/Messages/index.js"],"sourcesContent":["import SignUpModal from '../../components/SignUpModal/index.js';\nimport LogInModal from '../../components/LogInModal/index.js';\nimport MembershipModal from '../../components/MembershipModal/index.js';\nimport NewMessageModal from '../../components/NewMessageModal/index.js';\nimport { useContext, useState, useEffect, useCallback } from 'react';\nimport { ModalContext } from '../../context/ModalContext.js';\nimport { UserContext } from '../../context/UserContext.js';\nimport axios from '../../lib/axios.js';\nimport Spinner from './../../components/elements/Spinner.js';\nimport Message from './Message.js';\nimport Pagination from './Pagination.js';\nimport Header from './Header.js';\n\nexport default function Messages() {\n  const {\n    signupModal,\n    setSignupModal,\n    loginModal,\n    setLoginModal,\n    membershipModal,\n    setMembershipModal,\n    newMessageModal,\n    setNewMessageModal,\n  } = useContext(ModalContext);\n\n  const { auth } = useContext(UserContext);\n\n  const [loading, setLoading] = useState(false);\n\n  const [page, setPage] = useState(1);\n  const [messages, setMessages] = useState([]);\n  const [totalPages, setTotalPages] = useState(1);\n\n  const [deleteMsgId, setDeleteMsgId] = useState('');\n\n  const handlePageClick = (e) => {\n    setPage(e.selected + 1);\n  };\n\n  const getMessages = useCallback(async (page) => {\n    setLoading(true);\n\n    try {\n      const { data } = await axios.get('/api/messages', {\n        params: {\n          page,\n          limit: 10,\n        },\n      });\n\n      setMessages(data?.messages);\n      setTotalPages(data?.totalPages);\n    } catch (error) {\n      console.error(error);\n    }\n  }, []);\n\n  const handleDeleteMessage = async (id) => {\n    if (!id || !auth.is_admin) return;\n\n    const token = localStorage.getItem('token');\n\n    setDeleteMsgId(id);\n\n    try {\n      await axios.delete(`/api/messages/${id}`, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n\n      getMessages(page).finally(() => {\n        setLoading(false);\n        setDeleteMsgId('');\n      });\n    } catch (error) {\n      setDeleteMsgId('');\n      console.error(error);\n    }\n  };\n\n  useEffect(() => {\n    getMessages(page).finally(() => setLoading(false));\n  }, [page, getMessages]);\n\n  const messagesComponents = messages.map((message) => (\n    <Message\n      key={message._id}\n      message={message}\n      auth={auth}\n      handleDeleteMessage={handleDeleteMessage}\n      deleteMsgId={deleteMsgId}\n    />\n  ));\n\n  return (\n    <div className=\"relative min-h-screen pb-[90px] sm:pb-[110px]\">\n      <Header />\n\n      {loading ? (\n        <div className=\"flex justify-center items-center absolute inset-0 m-auto\">\n          <Spinner />\n        </div>\n      ) : (\n        <main className=\"bg-white w-full\">\n          <div className=\"max-w-7xl space-y-8 mt-12 mx-auto px-4 sm:px-6 lg:px-8\">\n            {/* <Message message={messages[0]} auth={auth} /> */}\n            {/* <Message message={messages[1]} auth={auth} /> */}\n            {messagesComponents}\n          </div>\n        </main>\n      )}\n\n      <Pagination\n        totalPages={totalPages}\n        page={page}\n        handlePageClick={handlePageClick}\n      />\n\n      <SignUpModal open={signupModal} close={setSignupModal} />\n      <LogInModal open={loginModal} close={setLoginModal} />\n      <MembershipModal open={membershipModal} close={setMembershipModal} />\n      <NewMessageModal\n        open={newMessageModal}\n        close={setNewMessageModal}\n        getMessages={getMessages}\n        stopMessagesSpinner={() => setLoading(false)}\n        page={page}\n        setPage={setPage}\n      />\n    </div>\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}